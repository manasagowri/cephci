import json
import os
import pdb

import yaml
from docopt import docopt

doc = """
    This script updates the /ceph/cephci-jenkins/results folder with the given test results"

    Usage:
        update_results.py --cephVersion <cephVersion> --testResults <results>

        update_confluence.py (-h | --help)

    Options:
        -h --help          Shows the command usage
        -c --cephVersion cephVersion     The ceph version for which the results have to be updated
        --testResults testResults          The test results to be updated in json format.
                                            Ex: '{"Sanity_Run": {"tier-0": {"stage-1": {"build_url": "",
                                                                                        "report_portal": "",
                                                                                        "test_suite_name": {
                                                                                            "result": "PASS",
                                                                                            "logdir": ""}}}}}'
"""


def update_nested_dict(current, updated):
    """
    Updates the nested dictionary current with the nested dictionary updated.
    If key exists both in current and updated, the value from updated is written to current
    If key doesn't exist in current, then a new key value pair is created
    Args:
        current: The nested dictionary to be updated
        updated: The nested dictionary with values to be updated to current
    """
    # pdb.set_trace()
    for key in updated:
        print("key")
        print(key)
        if isinstance(updated[key], str) or isinstance(updated[key], int) or isinstance(updated[key], list):
            current[key] = updated[key]
        elif key in current:
            update_nested_dict(current[key], updated[key])
        else:
            current.update({key: updated[key]})


def update_results(ceph_version, test_results):
    """
    Updates the given test results to the corresponding ceph_version file
    If the file doesn't exist, it creates one and adds results,
    If the file exists then it appends the results at the right place
    Args:
        ceph_version: the ceph version for which test results need to be updated
        test_results: the results to be updated
    """
    test_results_json = json.loads(test_results)
    file_path = f"/ceph/cephci-jenkins/results/{ceph_version}.yaml"

    # implement lock file functionality to avoid overwrites when file is already being written by another build
    if not os.path.exists(file_path):
        with open(file_path, "w", encoding="utf-8") as f:
            yaml.dump(test_results_json, f)
    else:
        with open(file_path, "r", encoding="utf-8") as f:
            current_content = f.read()
            print("current_content")
            print(current_content)
            current_content = yaml.safe_load(current_content)
        with open(file_path, "w", encoding="utf-8") as f:
            if not current_content:
                current_content = test_results_json
            else:
                update_nested_dict(current_content, test_results_json)
            yaml.dump(current_content, f)


if __name__ == "__main__":
    cli_args = docopt(doc)
    cephVersion = cli_args.get("--cephVersion")
    testResults = cli_args.get("--testResults")
    # update_results(cephVersion, testResults)
    testResults = '{"PSI-Only_Sanity_Run":{"tier-1":{"stage-1":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1664/display/redirect","report_portal":"null","test_results":{}}},"tier-2":{"stage-1":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1652/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6453","test_results":[{"executionTime":265,"failed":0,"id":162579,"name":"tier-2_rados_test-scrubbing","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6453/162579"}]},"stage-2":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1655/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6458","test_results":[{"executionTime":428,"failed":1,"id":162766,"name":"tier-2_rados_test-pool-functionalities","passed":14,"skipped":0,"status":"FAILED","total":15,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6458/162766"}]},"stage-3":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1656/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6459","test_results":[{"executionTime":95,"failed":0,"id":162782,"name":"tier-2_rados_test-slow-op-requests","passed":5,"skipped":0,"status":"PASSED","total":5,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6459/162782"}]},"stage-4":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1657/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6461","test_results":[{"executionTime":901,"failed":2,"id":162908,"name":"tier-2_rados_test-mon-db-trimming","passed":8,"skipped":0,"status":"FAILED","total":10,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6461/162908"}]}}},"RC_build_Sanity_Run":{"tier-0":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/807/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6488","test_results":[{"executionTime":131,"failed":0,"id":164012,"name":"tier-0","passed":4,"skipped":0,"status":"PASSED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6488/164012"}]}},"tier-1":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/809/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489","test_results":[{"executionTime":690,"failed":1,"id":164017,"name":"tier-0_fs","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489/164017"},{"executionTime":266,"failed":0,"id":164019,"name":"tier-1_upgrade_cephadm","passed":7,"skipped":0,"status":"PASSED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489/164019"},{"executionTime":357,"failed":0,"id":164020,"name":"tier-0_rgw","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489/164020"}]}}},"Sanity_Run":{"tier-0":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/770/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6443","test_results":[{"executionTime":80,"failed":0,"id":162186,"name":"tier-0","passed":4,"skipped":0,"status":"PASSED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6443/162186"}]}},"tier-1":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/771/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446","test_results":[{"executionTime":336,"failed":0,"id":162256,"name":"tier-0_fs","passed":8,"skipped":0,"status":"PASSED","total":8,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162256"},{"executionTime":409,"failed":0,"id":162262,"name":"tier-1_rbd","passed":11,"skipped":0,"status":"PASSED","total":11,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162262"},{"executionTime":3564,"failed":1,"id":162258,"name":"tier-1_upgrade_cephadm","passed":3,"skipped":0,"status":"FAILED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162258"},{"executionTime":387,"failed":0,"id":162260,"name":"test-container-cli-args","passed":7,"skipped":0,"status":"PASSED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162260"},{"executionTime":406,"failed":0,"id":162261,"name":"tier-0_rgw","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162261"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/773/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6448","test_results":{"executionTime":688,"failed":1,"id":162427,"name":"tier-0_5-1_cephadm","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6448/162427"}},"stage-3":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/775/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6450","test_results":{"executionTime":2307,"failed":1,"id":162452,"name":"tier-1_rgw_ecpool_ms-bucket-object-gc-policy-on-primary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6450/162452"}}},"tier-2":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/777/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454","test_results":[{"executionTime":353,"failed":0,"id":162589,"name":"tier-1_rgw_cephadm","passed":5,"skipped":0,"status":"PASSED","total":5,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162589"},{"executionTime":840,"failed":0,"id":162591,"name":"tier-2_rgw_test-bucket-notifications","passed":16,"skipped":0,"status":"PASSED","total":16,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162591"},{"executionTime":563,"failed":0,"id":162594,"name":"tier-2_cephfs_test-clients","passed":7,"skipped":0,"status":"PASSED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162594"},{"executionTime":633,"failed":0,"id":162593,"name":"tier-2_rgw_test-using-s3cmd","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162593"},{"executionTime":4034,"failed":2,"id":162596,"name":"tier-2_rgw_ssl_s3tests","passed":5,"skipped":0,"status":"FAILED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162596"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/779/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6455","test_results":{"executionTime":2361,"failed":1,"id":162640,"name":"tier-2_rgw_bucket_lc_multipart_object_expired","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6455/162640"}},"stage-3":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/780/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6457","test_results":{"executionTime":1671,"failed":1,"id":162709,"name":"tier-2_rgw_ssl_ecpool_ms-bucket-objects-gc-policy-on-secondary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6457/162709"}},"stage-4":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/781/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460","test_results":[{"executionTime":595,"failed":0,"id":162788,"name":"tier-2_rados_test-stretch-mode","passed":10,"skipped":0,"status":"PASSED","total":10,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162788"},{"executionTime":2187,"failed":0,"id":162791,"name":"tier-2_rgw_regression","passed":58,"skipped":0,"status":"PASSED","total":58,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162791"},{"executionTime":895,"failed":1,"id":162789,"name":"tier-1_upgrade_test-4x-to-5x-rpm","passed":8,"skipped":0,"status":"FAILED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162789"},{"executionTime":693,"failed":0,"id":162792,"name":"tier-1_rgw_ms-sync-policy-from-primary","passed":11,"skipped":0,"status":"PASSED","total":11,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162792"},{"executionTime":1378,"failed":0,"id":162793,"name":"tier-1_rgw_ssl_multisite_test-upgrade-5-to-latest","passed":27,"skipped":0,"status":"PASSED","total":27,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162793"}]},"stage-5":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/782/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6462","test_results":{"executionTime":963,"failed":1,"id":162919,"name":"tier-1_rgw_ms-omap-datalog-on-primary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6462/162919"}},"stage-6":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/783/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6463","test_results":{"executionTime":929,"failed":1,"id":162988,"name":"tier-2_rgw_ssl_ecpool-ms-bucket-listing-versioning-on-secondary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6463/162988"}}}},"Schedule_Run":{"tier-1":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/784/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464","test_results":[{"executionTime":738,"failed":0,"id":163024,"name":"tier-1_rgw_multisite_upgrade-5-to-latest","passed":24,"skipped":0,"status":"PASSED","total":24,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163024"},{"executionTime":243,"failed":0,"id":163027,"name":"tier-1_rgw_test-lc-multiple-bucket","passed":6,"skipped":0,"status":"PASSED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163027"},{"executionTime":348,"failed":1,"id":163026,"name":"tier-2_rados_test-stretch-mode-upgrade","passed":5,"skipped":0,"status":"FAILED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163026"},{"executionTime":928,"failed":0,"id":163028,"name":"tier-1_rgw_multisite_test-upgrade-4-to-latest","passed":23,"skipped":0,"status":"PASSED","total":23,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163028"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/787/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469","test_results":[{"executionTime":608,"failed":1,"id":163221,"name":"tier-1_rgw_ssl_test-upgrade-4-to-latest","passed":21,"skipped":0,"status":"FAILED","total":22,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469/163221"},{"executionTime":999,"failed":0,"id":163223,"name":"tier-1_rgw_test-upgrade-4-to-latest","passed":45,"skipped":0,"status":"PASSED","total":45,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469/163223"},{"executionTime":507,"failed":0,"id":163224,"name":"tier-1_rgw_test_upgrade-5-to-latest","passed":24,"skipped":0,"status":"PASSED","total":24,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469/163224"}]}},"tier-2":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/793/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471","test_results":[{"executionTime":1488,"failed":0,"id":163340,"name":"tier-2_dmfg_test-elasticity-after-upgrade-from-4-cdn-to-5-latest","passed":35,"skipped":0,"status":"PASSED","total":35,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163340"},{"executionTime":1024,"failed":0,"id":163341,"name":"tier-1_ssl_dashboard_port","passed":20,"skipped":0,"status":"PASSED","total":20,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163341"},{"executionTime":854,"failed":0,"id":163342,"name":"tier-1_skip_dashboard","passed":13,"skipped":0,"status":"PASSED","total":13,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163342"},{"executionTime":5011,"failed":1,"id":163348,"name":"tier-2_dmfg_test-elasticity-after-upgrade-from-5-cdn-to-5-latest","passed":3,"skipped":0,"status":"FAILED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163348"},{"executionTime":628,"failed":0,"id":163347,"name":"tier-2_cephfs_upgrade_4x_5x","passed":6,"skipped":0,"status":"PASSED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163347"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/795/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6479","test_results":{"executionTime":1395,"failed":1,"id":163713,"name":"tier-2_rados_test-ecpool-osd-rebalance","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6479/163713"}},"stage-3":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/801/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482","test_results":[{"executionTime":230,"failed":0,"id":163797,"name":"tier-2_rbd_mirror_snapshot_regression","passed":6,"skipped":0,"status":"PASSED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163797"},{"executionTime":311,"failed":0,"id":163799,"name":"tier-2_rgw_test-lc-prefix","passed":8,"skipped":0,"status":"PASSED","total":8,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163799"},{"executionTime":482,"failed":0,"id":163800,"name":"tier-2_rgw_singlesite_to_multisite","passed":23,"skipped":0,"status":"PASSED","total":23,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163800"},{"executionTime":311,"failed":0,"id":163802,"name":"tier-2_rgw_archive","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163802"}]}}}}'
    current = '{"PSI-Only_Sanity_Run":{"tier-1":{"stage-1":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1664/display/redirect","report_portal":"null","test_results":{}}},"tier-2":{"stage-1":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1652/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6453","test_results":[{"executionTime":265,"failed":0,"id":162579,"name":"tier-2_rados_test-scrubbing","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6453/162579"}]},"stage-2":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1655/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6458","test_results":[{"executionTime":428,"failed":1,"id":162766,"name":"tier-2_rados_test-pool-functionalities","passed":14,"skipped":0,"status":"FAILED","total":15,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6458/162766"}]},"stage-3":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1656/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6459","test_results":[{"executionTime":95,"failed":0,"id":162782,"name":"tier-2_rados_test-slow-op-requests","passed":5,"skipped":0,"status":"PASSED","total":5,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6459/162782"}]},"stage-4":{"build_url":"https://jenkins.ceph.redhat.com/job/rhceph-test-execution-pipeline/1657/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6461","test_results":[{"executionTime":901,"failed":2,"id":162908,"name":"tier-2_rados_test-mon-db-trimming","passed":8,"skipped":0,"status":"FAILED","total":10,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6461/162908"}]}}},"RC_build_Sanity_Run":{"tier-0":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/807/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6488","test_results":[{"executionTime":131,"failed":0,"id":164012,"name":"tier-0","passed":4,"skipped":0,"status":"PASSED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6488/164012"}]}},"tier-1":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/809/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489","test_results":[{"executionTime":690,"failed":1,"id":164017,"name":"tier-0_fs","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489/164017"},{"executionTime":266,"failed":0,"id":164019,"name":"tier-1_upgrade_cephadm","passed":7,"skipped":0,"status":"PASSED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489/164019"},{"executionTime":357,"failed":0,"id":164020,"name":"tier-0_rgw","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6489/164020"}]}}},"Sanity_Run":{"tier-0":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/770/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6443","test_results":[{"executionTime":80,"failed":0,"id":162186,"name":"tier-0","passed":4,"skipped":0,"status":"PASSED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6443/162186"}]}},"tier-1":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/771/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446","test_results":[{"executionTime":336,"failed":0,"id":162256,"name":"tier-0_fs","passed":8,"skipped":0,"status":"PASSED","total":8,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162256"},{"executionTime":409,"failed":0,"id":162262,"name":"tier-1_rbd","passed":11,"skipped":0,"status":"PASSED","total":11,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162262"},{"executionTime":3564,"failed":1,"id":162258,"name":"tier-1_upgrade_cephadm","passed":3,"skipped":0,"status":"FAILED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162258"},{"executionTime":387,"failed":0,"id":162260,"name":"test-container-cli-args","passed":7,"skipped":0,"status":"PASSED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162260"},{"executionTime":406,"failed":0,"id":162261,"name":"tier-0_rgw","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6446/162261"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/773/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6448","test_results":{"executionTime":688,"failed":1,"id":162427,"name":"tier-0_5-1_cephadm","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6448/162427"}},"stage-3":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/775/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6450","test_results":{"executionTime":2307,"failed":1,"id":162452,"name":"tier-1_rgw_ecpool_ms-bucket-object-gc-policy-on-primary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6450/162452"}}},"tier-2":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/777/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454","test_results":[{"executionTime":353,"failed":0,"id":162589,"name":"tier-1_rgw_cephadm","passed":5,"skipped":0,"status":"PASSED","total":5,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162589"},{"executionTime":840,"failed":0,"id":162591,"name":"tier-2_rgw_test-bucket-notifications","passed":16,"skipped":0,"status":"PASSED","total":16,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162591"},{"executionTime":563,"failed":0,"id":162594,"name":"tier-2_cephfs_test-clients","passed":7,"skipped":0,"status":"PASSED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162594"},{"executionTime":633,"failed":0,"id":162593,"name":"tier-2_rgw_test-using-s3cmd","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162593"},{"executionTime":4034,"failed":2,"id":162596,"name":"tier-2_rgw_ssl_s3tests","passed":5,"skipped":0,"status":"FAILED","total":7,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6454/162596"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/779/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6455","test_results":{"executionTime":2361,"failed":1,"id":162640,"name":"tier-2_rgw_bucket_lc_multipart_object_expired","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6455/162640"}},"stage-3":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/780/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6457","test_results":{"executionTime":1671,"failed":1,"id":162709,"name":"tier-2_rgw_ssl_ecpool_ms-bucket-objects-gc-policy-on-secondary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6457/162709"}},"stage-4":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/781/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460","test_results":[{"executionTime":595,"failed":0,"id":162788,"name":"tier-2_rados_test-stretch-mode","passed":10,"skipped":0,"status":"PASSED","total":10,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162788"},{"executionTime":2187,"failed":0,"id":162791,"name":"tier-2_rgw_regression","passed":58,"skipped":0,"status":"PASSED","total":58,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162791"},{"executionTime":895,"failed":1,"id":162789,"name":"tier-1_upgrade_test-4x-to-5x-rpm","passed":8,"skipped":0,"status":"FAILED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162789"},{"executionTime":693,"failed":0,"id":162792,"name":"tier-1_rgw_ms-sync-policy-from-primary","passed":11,"skipped":0,"status":"PASSED","total":11,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162792"},{"executionTime":1378,"failed":0,"id":162793,"name":"tier-1_rgw_ssl_multisite_test-upgrade-5-to-latest","passed":27,"skipped":0,"status":"PASSED","total":27,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6460/162793"}]},"stage-5":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/782/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6462","test_results":{"executionTime":963,"failed":1,"id":162919,"name":"tier-1_rgw_ms-omap-datalog-on-primary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6462/162919"}},"stage-6":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/783/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6463","test_results":{"executionTime":929,"failed":1,"id":162988,"name":"tier-2_rgw_ssl_ecpool-ms-bucket-listing-versioning-on-secondary","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6463/162988"}}}},"Schedule_Run":{"tier-1":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/784/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464","test_results":[{"executionTime":738,"failed":0,"id":163024,"name":"tier-1_rgw_multisite_upgrade-5-to-latest","passed":24,"skipped":0,"status":"PASSED","total":24,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163024"},{"executionTime":243,"failed":0,"id":163027,"name":"tier-1_rgw_test-lc-multiple-bucket","passed":6,"skipped":0,"status":"PASSED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163027"},{"executionTime":348,"failed":1,"id":163026,"name":"tier-2_rados_test-stretch-mode-upgrade","passed":5,"skipped":0,"status":"FAILED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163026"},{"executionTime":928,"failed":0,"id":163028,"name":"tier-1_rgw_multisite_test-upgrade-4-to-latest","passed":23,"skipped":0,"status":"PASSED","total":23,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6464/163028"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/787/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469","test_results":[{"executionTime":608,"failed":1,"id":163221,"name":"tier-1_rgw_ssl_test-upgrade-4-to-latest","passed":21,"skipped":0,"status":"FAILED","total":22,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469/163221"},{"executionTime":999,"failed":0,"id":163223,"name":"tier-1_rgw_test-upgrade-4-to-latest","passed":45,"skipped":0,"status":"PASSED","total":45,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469/163223"},{"executionTime":507,"failed":0,"id":163224,"name":"tier-1_rgw_test_upgrade-5-to-latest","passed":24,"skipped":0,"status":"PASSED","total":24,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6469/163224"}]}},"tier-2":{"stage-1":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/793/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471","test_results":[{"executionTime":1488,"failed":0,"id":163340,"name":"tier-2_dmfg_test-elasticity-after-upgrade-from-4-cdn-to-5-latest","passed":35,"skipped":0,"status":"PASSED","total":35,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163340"},{"executionTime":1024,"failed":0,"id":163341,"name":"tier-1_ssl_dashboard_port","passed":20,"skipped":0,"status":"PASSED","total":20,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163341"},{"executionTime":854,"failed":0,"id":163342,"name":"tier-1_skip_dashboard","passed":13,"skipped":0,"status":"PASSED","total":13,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163342"},{"executionTime":5011,"failed":1,"id":163348,"name":"tier-2_dmfg_test-elasticity-after-upgrade-from-5-cdn-to-5-latest","passed":3,"skipped":0,"status":"FAILED","total":4,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163348"},{"executionTime":628,"failed":0,"id":163347,"name":"tier-2_cephfs_upgrade_4x_5x","passed":6,"skipped":0,"status":"PASSED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6471/163347"}]},"stage-2":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/795/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6479","test_results":{"executionTime":1395,"failed":1,"id":163713,"name":"tier-2_rados_test-ecpool-osd-rebalance","passed":0,"skipped":0,"status":"FAILED","total":1,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6479/163713"}},"stage-3":{"build_url":"https://159.23.92.24/job/rhceph-test-execution-pipeline/801/display/redirect","report_portal":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482","test_results":[{"executionTime":230,"failed":0,"id":163797,"name":"tier-2_rbd_mirror_snapshot_regression","passed":6,"skipped":0,"status":"PASSED","total":6,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163797"},{"executionTime":311,"failed":0,"id":163799,"name":"tier-2_rgw_test-lc-prefix","passed":8,"skipped":0,"status":"PASSED","total":8,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163799"},{"executionTime":482,"failed":0,"id":163800,"name":"tier-2_rgw_singlesite_to_multisite","passed":23,"skipped":0,"status":"PASSED","total":23,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163800"},{"executionTime":311,"failed":0,"id":163802,"name":"tier-2_rgw_archive","passed":9,"skipped":0,"status":"PASSED","total":9,"url":"https://reportportal-rhcephqe.apps.ocp-c1.prod.psi.redhat.com/ui/#cephci/launches/all/6482/163802"}]}}}}'
    testResults = json.loads(testResults)
    current = json.loads(current)
    update_nested_dict(current, testResults)